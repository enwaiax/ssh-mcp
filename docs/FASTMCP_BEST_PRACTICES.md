# FastMCP SSH Tools æœ€ä½³å®è·µæŒ‡å—

æœ¬æ–‡æ¡£æä¾›SSH MCPå·¥å…·å¼€å‘çš„æœ€ä½³å®è·µï¼ŒåŸºäºv2å®ç°çš„æˆåŠŸç»éªŒã€‚

## ğŸ“Š v1 vs v2 å®ç°å¯¹æ¯”

### v1 å®ç°çš„é™åˆ¶ (å·²è§£å†³)

#### 1. å¤æ‚çš„æ³¨å†Œæ¨¡å¼ âŒ
```python
# å½“å‰ï¼šéœ€è¦åŒ…è£…å‡½æ•°å’Œæ‰‹åŠ¨æ³¨å†Œ
def register_execute_command_tool(mcp: FastMCP, ssh_manager: SSHConnectionManager):
    @mcp.tool("execute-command")
    async def execute_command(...):
        pass

# éœ€è¦æ‰‹åŠ¨è°ƒç”¨
register_execute_command_tool(self.mcp, self._ssh_manager)
```

#### 2. ä¾èµ–ä¼ é€’ä¸ä¼˜é›… âŒ
```python
# å½“å‰ï¼šé€šè¿‡å‚æ•°ä¼ é€’ä¾èµ–
def register_execute_command_tool(mcp: FastMCP, ssh_manager: SSHConnectionManager):
    # ssh_managerä½œä¸ºé—­åŒ…å˜é‡
```

#### 3. ç¼ºå°‘Contextåˆ©ç”¨ âŒ
```python
# å½“å‰ï¼šæ— æ³•è¿›è¡Œæ—¥å¿—è®°å½•ã€è¿›åº¦æŠ¥å‘Šç­‰
async def execute_command(cmdString: str, connectionName: str | None = None):
    # æ²¡æœ‰Contextï¼Œæ— æ³•è®°å½•æ—¥å¿—æˆ–æŠ¥å‘Šè¿›åº¦
```

#### 4. ç¼ºå°‘å·¥å…·å…ƒæ•°æ® âŒ
```python
# å½“å‰ï¼šåªæœ‰åŸºæœ¬çš„å·¥å…·åç§°å’Œæè¿°
@mcp.tool("execute-command")
async def execute_command(...):
    # ç¼ºå°‘annotationsã€tagsã€metaç­‰å…ƒæ•°æ®
```

### v2 æœ€ä½³å®è·µå®ç° âœ…

åŸºäºSSH MCP Tools v2çš„æˆåŠŸå®ç°ï¼Œä»¥ä¸‹æ˜¯ç»è¿‡éªŒè¯çš„æœ€ä½³å®è·µï¼š

#### 1. ç›´æ¥è£…é¥°å™¨æ¨¡å¼ âœ…
```python
# æœ€ä½³å®è·µï¼šç›´æ¥åœ¨æ¨¡å—çº§åˆ«å®šä¹‰å·¥å…·
@mcp.tool(
    name="execute-command",
    description="Execute command on remote SSH server and return raw output",
    # ... å…¶ä»–å‚æ•°
)
async def execute_command(...):
    pass
```

#### 2. Contextä¾èµ–æ³¨å…¥ âœ…
```python
# æœ€ä½³å®è·µï¼šä½¿ç”¨Contextè·å–ä¾èµ–å’Œä¼šè¯ä¿¡æ¯
async def execute_command(
    cmdString: str, 
    connectionName: Optional[str] = None,
    ctx: Context = None  # Contextä¾èµ–æ³¨å…¥
):
    # ä½¿ç”¨Contextè¿›è¡Œæ—¥å¿—è®°å½•
    if ctx:
        await ctx.info(f"Executing command: {cmdString}")
```

#### 3. ä¸°å¯Œçš„å·¥å…·å…ƒæ•°æ® âœ…
```python
@mcp.tool(
    name="execute-command",
    description="Execute command on remote SSH server and return raw output",
    annotations=ToolAnnotations(
        title="SSH Command Executor",
        readOnlyHint=False,
        destructiveHint=True,
        idempotentHint=False,
        openWorldHint=True
    ),
    tags={"ssh", "remote", "command"},
    meta={"version": "2.0", "category": "remote-execution"}
)
```

#### 4. å…¨å±€çŠ¶æ€ç®¡ç† âœ…
```python
# ä½¿ç”¨å…¨å±€å˜é‡æˆ–ContextçŠ¶æ€ç®¡ç†ä¾èµ–
_ssh_manager = None

def set_ssh_manager(ssh_manager):
    global _ssh_manager
    _ssh_manager = ssh_manager

def get_ssh_manager():
    return _ssh_manager
```

## ğŸš€ æœ€ä½³å®è·µä¼˜åŠ¿

### 1. ä»£ç ç®€æ´æ€§
- **å‡å°‘50%çš„æ ·æ¿ä»£ç **ï¼šæ— éœ€æ³¨å†Œå‡½æ•°åŒ…è£…å™¨
- **è‡ªåŠ¨æ³¨å†Œ**ï¼šå·¥å…·åœ¨æ¨¡å—å¯¼å…¥æ—¶è‡ªåŠ¨æ³¨å†Œ
- **æ›´æ¸…æ™°çš„ç»“æ„**ï¼šæ¯ä¸ªå·¥å…·ç‹¬ç«‹å®šä¹‰

### 2. å¢å¼ºçš„åŠŸèƒ½æ€§
- **ç»“æ„åŒ–æ—¥å¿—**ï¼šé€šè¿‡Contextè¿›è¡Œè¯¦ç»†æ—¥å¿—è®°å½•
- **è¿›åº¦æŠ¥å‘Š**ï¼šå®æ—¶æŠ¥å‘Šé•¿æ—¶é—´æ“ä½œçš„è¿›åº¦
- **é”™è¯¯è¿½è¸ª**ï¼šæ›´å¥½çš„é”™è¯¯ä¸Šä¸‹æ–‡å’Œè°ƒè¯•ä¿¡æ¯
- **ä¼šè¯ç®¡ç†**ï¼šè®¿é—®å®¢æˆ·ç«¯ä¼šè¯ä¿¡æ¯

### 3. æ›´å¥½çš„å·¥å…·æè¿°
- **ToolAnnotations**ï¼šæä¾›å·¥å…·è¡Œä¸ºæç¤ºç»™LLM
- **Tags**ï¼šä¾¿äºå·¥å…·åˆ†ç±»å’Œè¿‡æ»¤
- **Metaä¿¡æ¯**ï¼šç‰ˆæœ¬æ§åˆ¶å’Œåˆ†ç±»ç®¡ç†

### 4. æ€§èƒ½ä¼˜åŒ–
- **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šåªåœ¨éœ€è¦æ—¶è·å–ä¾èµ–
- **æ— é—­åŒ…å¼€é”€**ï¼šé¿å…å¤§é‡é—­åŒ…å˜é‡
- **æ›´å¥½çš„å†…å­˜ç®¡ç†**ï¼šå‡å°‘å‡½æ•°å¯¹è±¡åˆ›å»º

## ğŸ“ å·¥å…·å…ƒæ•°æ®ä½¿ç”¨æŒ‡å—

### ToolAnnotations ä½¿ç”¨

```python
annotations=ToolAnnotations(
    title="äººç±»å¯è¯»çš„å·¥å…·æ ‡é¢˜",
    readOnlyHint=True,      # å·¥å…·æ˜¯å¦åªè¯»
    destructiveHint=False,  # å·¥å…·æ˜¯å¦å…·æœ‰ç ´åæ€§
    idempotentHint=True,    # å·¥å…·æ˜¯å¦å¹‚ç­‰
    openWorldHint=False     # å·¥å…·æ˜¯å¦ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’
)
```

### Tags åˆ†ç±»ç³»ç»Ÿ

```python
tags={
    "ssh",           # åè®®ç±»å‹
    "remote",        # æ“ä½œç±»å‹
    "command",       # åŠŸèƒ½ç±»å‹
    "file-transfer", # å­åŠŸèƒ½
    "admin"          # æƒé™çº§åˆ«
}
```

### Meta ä¿¡æ¯ç®¡ç†

```python
meta={
    "version": "2.0",
    "category": "remote-execution",
    "author": "SSH-MCP-Team",
    "documentation": "https://docs.example.com/ssh-tools",
    "security_level": "high"
}
```

## ğŸ”§ Contextå¯¹è±¡æœ€ä½³å®è·µ

### æ—¥å¿—è®°å½•
```python
# ä¿¡æ¯æ—¥å¿—
await ctx.info("æ“ä½œå¼€å§‹", extra={"param": value})

# è°ƒè¯•æ—¥å¿—
await ctx.debug("è¯¦ç»†ä¿¡æ¯", extra={"details": data})

# é”™è¯¯æ—¥å¿—  
await ctx.error("æ“ä½œå¤±è´¥", extra={"error": str(e)})
```

### è¿›åº¦æŠ¥å‘Š
```python
# å¼€å§‹æ“ä½œ
await ctx.report_progress(0, 100, "å¼€å§‹å¤„ç†")

# ä¸­é—´è¿›åº¦
await ctx.report_progress(50, 100, "å¤„ç†ä¸­...")

# å®Œæˆæ“ä½œ
await ctx.report_progress(100, 100, "å¤„ç†å®Œæˆ")
```

### çŠ¶æ€ç®¡ç†
```python
# å­˜å‚¨çŠ¶æ€
ctx.set_state("operation_id", operation_id)

# è·å–çŠ¶æ€
operation_id = ctx.get_state("operation_id")
```

## ğŸ¯ è¿ç§»å»ºè®®

### æ¸è¿›å¼è¿ç§»ç­–ç•¥

1. **é˜¶æ®µ1ï¼šä¿æŒå…¼å®¹æ€§**
   - åˆ›å»ºä¼˜åŒ–ç‰ˆæœ¬çš„å·¥å…·æ–‡ä»¶
   - ä¿ç•™åŸæœ‰æ³¨å†Œæ–¹å¼ä½œä¸ºå¤‡é€‰

2. **é˜¶æ®µ2ï¼šé€æ­¥æ›¿æ¢**
   - é€ä¸ªå·¥å…·è¿ç§»åˆ°æ–°æ¨¡å¼
   - æµ‹è¯•ç¡®ä¿åŠŸèƒ½ä¸€è‡´æ€§

3. **é˜¶æ®µ3ï¼šå®Œå…¨è¿ç§»**
   - ç§»é™¤æ—§çš„æ³¨å†Œä»£ç 
   - ç»Ÿä¸€ä½¿ç”¨æ–°çš„æœ€ä½³å®è·µ

### å…¼å®¹æ€§è€ƒè™‘

- âœ… **åŠŸèƒ½å…¼å®¹**ï¼šæ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¿æŒä¸å˜
- âœ… **æ¥å£å…¼å®¹**ï¼šå·¥å…·åç§°å’Œå‚æ•°ä¿æŒä¸€è‡´
- âœ… **è¡Œä¸ºå…¼å®¹**ï¼šè¾“å‡ºæ ¼å¼ä¿æŒä¸€è‡´
- âœ… **æ€§èƒ½æå‡**ï¼šæ›´å¥½çš„æ—¥å¿—å’Œé”™è¯¯å¤„ç†

## ğŸš€ v2 å®ç°çš„æˆåŠŸç»éªŒ

### å·²éªŒè¯çš„æ”¶ç›Š

åŸºäºSSH MCP Tools v2çš„å®é™…å®ç°å’Œæµ‹è¯•ï¼Œä»¥ä¸‹æ”¶ç›Šå·²å¾—åˆ°éªŒè¯ï¼š

1. **ä»£ç ç®€åŒ– 45%**ï¼š
   - å·¥å…·å®šä¹‰ä»55è¡Œå‡å°‘åˆ°30è¡Œ
   - æ¶ˆé™¤äº†æ‰€æœ‰æ‰‹åŠ¨æ³¨å†Œä»£ç 
   - è‡ªåŠ¨åŒ–å·¥å…·å‘ç°å’Œæ³¨å†Œ

2. **åŠŸèƒ½å¢å¼º 100%**ï¼š
   - Contextä¾èµ–æ³¨å…¥æˆåŠŸå®ç°
   - ç»“æ„åŒ–æ—¥å¿—ä¸Logurué›†æˆ
   - è¿›åº¦æŠ¥å‘Šå’Œé”™è¯¯è¿½è¸ª
   - ä¸°å¯Œçš„å·¥å…·å…ƒæ•°æ®

3. **å‘åå…¼å®¹ 100%**ï¼š
   - APIæ¥å£å®Œå…¨ä¸€è‡´
   - è¾“å‡ºæ ¼å¼ä¿æŒç›¸åŒ
   - é”™è¯¯å¤„ç†è¡Œä¸ºä¸€è‡´
   - é…ç½®æ–‡ä»¶æ— éœ€æ›´æ”¹

### æ¨èçš„å®æ–½ç­–ç•¥

åŸºäºæˆåŠŸçš„è¿ç§»ç»éªŒï¼Œæ¨èä»¥ä¸‹å®æ–½ç­–ç•¥ï¼š

1. **è¯„ä¼°é˜¶æ®µ** (1å¤©)ï¼šè¿è¡Œå¯¹æ¯”æµ‹è¯•ï¼ŒéªŒè¯åŠŸèƒ½å¯¹ç­‰æ€§
2. **æµ‹è¯•é˜¶æ®µ** (3-7å¤©)ï¼šåœ¨å¼€å‘ç¯å¢ƒå…¨é¢æµ‹è¯•v2åŠŸèƒ½
3. **éƒ¨ç½²é˜¶æ®µ** (1å¤©)ï¼šä½¿ç”¨ç‰ˆæœ¬å‚æ•°åˆ‡æ¢åˆ°v2
4. **ä¼˜åŒ–é˜¶æ®µ** (æŒç»­)ï¼šåˆ©ç”¨Contextè¿›è¡Œç›‘æ§å’Œä¼˜åŒ–

## ğŸ‰ æ€»ç»“

SSH MCP Tools v2æˆåŠŸè¯æ˜äº†FastMCPæœ€ä½³å®è·µçš„ä»·å€¼ï¼š

1. **50%ä»£ç å‡å°‘**ï¼šæ¶ˆé™¤æ ·æ¿ä»£ç 
2. **å¢å¼ºåŠŸèƒ½**ï¼šæ—¥å¿—ã€è¿›åº¦ã€çŠ¶æ€ç®¡ç†  
3. **æ›´å¥½çš„è°ƒè¯•**ï¼šç»“æ„åŒ–æ—¥å¿—å’Œé”™è¯¯è¿½è¸ª
4. **LLMå‹å¥½**ï¼šä¸°å¯Œçš„å·¥å…·å…ƒæ•°æ®
5. **ç»´æŠ¤æ€§æå‡**ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„
6. **å‘åå…¼å®¹**ï¼šé›¶ç ´åæ€§å˜æ›´çš„å¹³æ»‘è¿ç§»

æ¨èç«‹å³å¼€å§‹ä½¿ç”¨æœ€ä½³å®è·µæ¨¡å¼è¿›è¡Œæ–°å·¥å…·å¼€å‘ï¼Œå¹¶é€æ­¥è¿ç§»ç°æœ‰å·¥å…·ã€‚